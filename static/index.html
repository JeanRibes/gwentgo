<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>

    <link href="/static/win98/layout.css" rel="stylesheet" type="text/css">
    <link href="/static/win98/windows-98.css" rel="stylesheet" type="text/css">
    <link href="/static/win98/windows-default.css" rel="stylesheet" title="Windows Default" type="text/css">

    <script src="/static/win98/jquery-3.3.1.js"></script>
    <script src="/static/win98/MenuBar.js"></script>
    <script src="/static/win98/$Window.js"></script>
</head>
<body>
<a href="/register">register</a>
<br/>
<a href="/multi/create" target="_blank">create game</a>
<br/>
<a href="/deck/0/">manage decks</a>

<div class="window os-window" id="os-window-obo0xqr92"
     style="touch-action: none; position: absolute; z-index: 29; left: 19.2px; top: 805.8px;">
    <div class="window-titlebar" style="touch-action: none;">
        <div class="window-title-area"><span class="window-title">Application Window</span></div>
        <button class="window-minimize-button window-action-minimize window-button" aria-label="Minimize window"><span
                class="window-button-icon"></span></button>
        <button class="window-maximize-button window-action-maximize window-button"
                aria-label="Maximize or restore window"><span class="window-button-icon"></span></button>
        <button class="window-close-button window-action-close window-button" aria-label="Close window"><span
                class="window-button-icon"></span></button>
    </div>
    <div class="window-content" tabindex="-1" style="outline: currentcolor none medium;">
        <p>This is a window that can be moved around and resized.</p>
    </div>
    <div class="handle"
         style="position: absolute; top: -2px; right: -2px; width: 4px; height: 4px; touch-action: none; cursor: ne-resize;"></div>
    <div class="handle"
         style="position: absolute; top: -2px; left: calc(2px); width: calc(100% - 4px); height: 4px; touch-action: none; cursor: n-resize;"></div>
    <div class="handle"
         style="position: absolute; top: -2px; left: -2px; width: 4px; height: 4px; touch-action: none; cursor: nw-resize;"></div>
    <div class="handle"
         style="position: absolute; top: calc(2px); left: -2px; width: 4px; height: calc(100% - 4px); touch-action: none; cursor: w-resize;"></div>
    <div class="handle"
         style="position: absolute; bottom: -2px; left: -2px; width: 4px; height: 4px; touch-action: none; cursor: sw-resize;"></div>
    <div class="handle"
         style="position: absolute; bottom: -2px; left: calc(2px); width: calc(100% - 4px); height: 4px; touch-action: none; cursor: s-resize;"></div>
    <div class="handle"
         style="position: absolute; bottom: -2px; right: -2px; width: 4px; height: 4px; touch-action: none; cursor: se-resize;"></div>
    <div class="handle"
         style="position: absolute; top: calc(2px); right: -2px; width: 4px; height: calc(100% - 4px); touch-action: none; cursor: e-resize;"></div>
</div>

<div class="window os-window" id="os-window-i3lvhb7b1"
     style="touch-action: none; position: absolute; z-index: 11; left: 829.717px; top: 130.1px;">
    <div class="window-titlebar" style="touch-action: none;"><img
            src="https://win98icons.alexmeub.com/icons/png/application_hammer_grouppol-0.png" draggable="false"
            style="width: 16px; height: 16px;" width="16" height="16">
        <div class="window-title-area"><span class="window-title">Test Station</span></div>
        <button class="window-minimize-button window-action-minimize window-button" aria-label="Minimize window"><span
                class="window-button-icon"></span></button>
        <button class="window-maximize-button window-action-maximize window-button"
                aria-label="Maximize or restore window" disabled="disabled"><span class="window-button-icon"></span>
        </button>
        <button class="window-close-button window-action-close window-button" aria-label="Close window"><span
                class="window-button-icon"></span></button>
    </div>
    <div class="menus" role="menubar" aria-label="Application Menu" style="touch-action: none;"
         aria-owns=" menu-popup-09ri0cljoa2g menu-popup-3aov2vz61fhi menu-popup-p1gng2n90du4m menu-popup-pdzk1cb0lx28k">
        <div class="menu-button dialogs-menu-button" aria-expanded="false" aria-haspopup="true" role="menuitem"
             id="menu-button-&amp;Dialogs-2q7k0zz3sd9" aria-controls="menu-popup-09ri0cljoa2g" tabindex="-1"><span
                class="menu-hotkey">D</span>ialogs
        </div>
        <div class="menu-button submenus-menu-button" aria-expanded="false" aria-haspopup="true" role="menuitem"
             id="menu-button-&amp;Submenus-p0i98sb3496a" aria-controls="menu-popup-3aov2vz61fhi" tabindex="-1"><span
                class="menu-hotkey">S</span>ubmenus
        </div>
        <div class="menu-button enabled-menu-button" aria-expanded="false" aria-haspopup="true" role="menuitem"
             id="menu-button-&amp;Enabled-pcjq9k9wtcwsr" aria-controls="menu-popup-p1gng2n90du4m" tabindex="-1"><span
                class="menu-hotkey">E</span>nabled
        </div>
        <div class="menu-button help-menu-button" aria-expanded="false" aria-haspopup="true" role="menuitem"
             id="menu-button-&amp;Help-s6onnv26ebxae" aria-controls="menu-popup-pdzk1cb0lx28k" tabindex="-1"><span
                class="menu-hotkey">H</span>elp
        </div>
    </div>
    <div class="window-content" tabindex="-1"
         style="outline: currentcolor none medium; display: flex; flex-direction: column; justify-content: stretch;">
        <button id="open-recursive-dialog"
                style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;" class="lightweight">
            <img draggable="false" src="https://win98icons.alexmeub.com/icons/png/accessibility_two_windows.png"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Recursive Dialog
        </button>
        <button id="test-tabstop-wrapping"
                style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;" class="lightweight">
            <img draggable="false" src="https://win98icons.alexmeub.com/icons/png/accessibility_big_keys.png"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Tabstop Wrapping
        </button>
        <button id="test-iframes" style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;"
                class="lightweight">
            <img draggable="false" src="https://win98icons.alexmeub.com/icons/png/html-3.png"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Nested Iframes
        </button>
        <button id="test-selection" style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;"
                class="lightweight">
            <img draggable="false" src="https://win98icons.alexmeub.com/icons/png/file_lines-0.png"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Selectable Text
        </button>
        <button id="test-icon-size" style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;"
                class="lightweight">
            <img draggable="false" src="https://win98icons.alexmeub.com/icons/png/camera3_network-3.png"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Icon Size + Long Title
        </button>
        <button id="test-theme" style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;"
                class="lightweight">
            <img draggable="false" src="https://win98icons.alexmeub.com/icons/png/themes-2.png"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Window Theme
        </button>
        <button id="test-triggering" style="display: flex; flex-direction: row; align-items: center; margin: 0.2em;"
                class="lightweight">
            <img draggable="false"
                 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAl1JREFUWEfVVltywyAMFBeLc7EacC+W5GClswIRWQY/Ejcz5SvBoF1pV7IdqRUiJfx1ehM72EhEyRG5ROTD/Ig+fvR3xQI4/nyNQiCjMqNCAjvT5Ch43p/xPAos5+dBnEuUcmhk+pMASOR9rgsecyVOAl9U28rhx5xxJsAFOn11g4ZAKRMg8pFl+DCBmAnESBQCJ/5ZAjG4NI6Jpm9IsGyOs7SYZRVjTPC342QDMQF4ICQKATrkJZe8929XpQYA+PV6rSDDMMySjNCirHEcyTm+eg4BC75W3svlQtM0kZfefFMLB3BktHcBHOtUArr0a0Rut1t9/G8IxDzIyXf8whL8VQUALuLCrWJjTaZJQEptiR2RQIPDNZjmXIpn6+Q2alUALYi2e5XAGriQER5dAvf7feFHW4HeGRgU2drMc//kJTIsCCD7VmBcEgIA6IGjapgVZVDVsvdkYAI6VQTXU8+WYQ/44/HgayDM8YwHtAzlY2vvGKJ25mVs82dDWToJkQSPBBwVHIYhD3S1Ei4eeclow4nD5TNSSFhPiHxNAorM5otGhgx6vWU4VESTQGwNrlqSYWubwhdbo9YOGSGu3Y89TcCCLwiU8nMs0ajljrXMbdkkZgt8QWANtJrLjNdW5lJKbTicg+Y2Ib0hBpQzTQ9I6Tt9zXfVzF9ovkZAfMCzYcMDdXZoMDPrN8GtBNqI+pl0VSXfM+CRzHtlZhkwToteWpbn9+OzY1pvuV2Zr+nMlSyGtLMF+0lGrDIm/0Tf99ze6qaWBPrcU+dSFQM8M7CQ7rn9FQJNMmd8iuvAv0XzaDC1qAqpAAAAAElFTkSuQmCC"
                 style="vertical-align: middle; margin-right: 0.5em; margin-left: 0.5em;" width="32" height="32">
            Trigger Station
        </button>
    </div>
</div>


<script>
    let nothingness_state = true;
    const menus = {
        "&File": [
            {
                item: "&Open",
                action: () => {
                    const $w = $Window({
                        title: "Ali Baba and the Forty Thieves",
                        resizable: false,
                        maximizeButton: false,
                        minimizeButton: false
                    });
                    $w.$content.html("<p>\"Open Sesame!\"</p>");
                    $w.$Button("OK", () => $w.close()).focus().css({width: 100});
                    $w.center();
                },
                shortcut: "Ctrl+O",
                description: "Shows a silly dialog box.",
            },
            MENU_DIVIDER,
            {
                item: "&Brexit",
                action: () => {
                    const $w = $Window({
                        title: "Membership Status",
                        resizable: false,
                        maximizeButton: false,
                        minimizeButton: false
                    });
                    $w.$content.html("<p>You have left the EU.</p>");
                    $w.$Button("OK", () => $w.close()).focus().css({width: 100});
                    $w.center();
                },
                description: "Shows a stupid dialog box.",
            }
        ],
        "&View": [
            {
                item: "&Nothingness",
                checkbox: {
                    check: () => nothingness_state,
                    toggle: () => {
                        nothingness_state = !nothingness_state;
                    }
                },
                description: "Tick a meaningless checkbox.",
            },
        ],
    };
    // wait for page load (could alternatively just move the script so it executes after the elements are declared)
    $(() => {
        // Create menu bar
        const menubar = new MenuBar(menus);
        $(menubar.element).appendTo("#menubar-example");

        // Create demo windows
        const $app_window_1 = new $Window({title: "Application Window", resizable: true});
        $app_window_1.$content.append(`
		<p>This is a window that can be moved around and resized.</p>
	`);
        fake_closing($app_window_1);

        const $tool_window_1 = new $Window({title: "Tool Window", toolWindow: true});
        $tool_window_1.$content.text("This is a tool window.");
        fake_closing($tool_window_1);

        const $app_window_2 = new $Window({title: "Application Example", resizable: true});
        const app_window_2_menu_bar = new MenuBar(menus);
        $app_window_2.setMenuBar(app_window_2_menu_bar);
        $app_window_2.$content.css({
            padding: 0,
            display: "flex",
            flexDirection: "column",
        });
        $app_window_2.$content.append(`
		<div class="inset-deep" style="padding: 20px; background: var(--Window); color: var(--WindowText); user-select: text; cursor: text; flex: 1;">
			<p>This is the main application window.</p>
			<p>It has a tool window that belongs to it, as well as a menu bar.</p>
		</div>
	`);
        const $status_bar = $("<div class='status-bar inset-shallow' style='height:1.5em;line-height:1.5em;font-size:12px;margin-top:2px;'>").appendTo($app_window_2.$content);
        $(app_window_2_menu_bar.element).on("info", (event, info) => {
            // info = `event.detail.description: ${event.detail.description}, jQuery second arg: ${info}`; // testing
            info = event.detail.description; // new API
            $status_bar.text(info);
        });

        function showDefaultStatus() {
            $status_bar.text("I am a status bar. This is my default text.");
        }

        showDefaultStatus();
        $(app_window_2_menu_bar.element).on("default-info", (event) => {
            showDefaultStatus();
        });
        fake_closing($app_window_2);
        const $tool_window_2 = new $Window({title: "Tool Window", toolWindow: true, parentWindow: $app_window_2});
        $tool_window_2.$content.text("This tool window is a child of the app window.");
        fake_closing($tool_window_2);
        $app_window_2.on("closed", () => {
            $tool_window_2.close();
        });

        const $app_window_3 = new $Window({title: "Right-To-Left Example", resizable: true});
        $app_window_3.css("direction", "rtl");
        $app_window_3.setMenuBar(new MenuBar(menus));
        $app_window_3.$content.css({
            padding: 0,
            display: "flex",
            flexDirection: "column",
        });
        $app_window_3.$content.append(`
		<div style='padding: 20px; background: var(--Window); color: var(--WindowText); user-select: text; cursor: text; flex: 1;'>
			<p dir="ltr">You can imagine some Hebrew/Arabic/etc. text in the menus and titlebar.</p>
		</div>
	`);
        fake_closing($app_window_3);

        // Position the windows within the demo page, in the flow of text, but freely moveable
        const $windows_and_$positioners = [
            [$app_window_1, $("#app-window-example")],
            [$tool_window_1, $("#tool-window-example")],
            [$app_window_2, $("#app-window-2-positioner")],
            [$tool_window_2, $("#tool-window-2-positioner")],
            [$app_window_3, $("#app-window-3-positioner")],
        ];

        function position_windows() {
            for (const [$window, $positioning_el] of $windows_and_$positioners) {
                // in a separate loop to prevent layout thrashing (untested performance optimization)
                $positioning_el._new_offset = $positioning_el.offset();
            }
            for (const [$window, $positioning_el] of $windows_and_$positioners) {
                const {_new_offset, _old_offset} = $positioning_el;
                if (
                    _new_offset.top !== _old_offset?.top ||
                    _new_offset.left !== _old_offset?.left
                ) {
                    $window.restore(); // in case it was minimized or maximized
                    $window.css({
                        left: _new_offset.left,
                        top: _new_offset.top,
                        width: "",
                        height: "",
                    });
                    $positioning_el._old_offset = _new_offset;
                }
            }
        }

        $(window).on("resize", position_windows);
        position_windows();

        // Fake closing the windows (hide and fade back in), for demo purposes
        function fake_closing($window) {
            $window.on("close", (event) => {
                event.preventDefault();
                $window.triggerHandler("closed");
                $window.closed = true;
                $window.hide();
                setTimeout(() => {
                    // Restore position
                    const $positioning_el = $windows_and_$positioners.find(([$other_window]) => $window === $other_window)[1];
                    $window.restore(); // in case it was minimized or maximized
                    $window.css({
                        left: $positioning_el.offset().left,
                        top: $positioning_el.offset().top,
                        width: "",
                        height: "",
                    });
                    // Fade back in
                    $window.fadeIn();
                    // Ta-da! It was there all along!
                    $window.closed = false;
                }, 1000);
            });
        }

        // Handle toggle buttons
        $("button.toggle").on("click", (e) => {
            $(e.target).toggleClass("selected");
            $(e.target).attr("aria-pressed", $(e.target).hasClass("selected"));
        });

        // Load themes on drag and drop (.theme/.themepack files)
        async function loadThemeFile(file) {
            const fileText = await file.text();
            const cssProperties = parseThemeFileString(fileText);
            if (cssProperties) {
                applyCSSProperties(cssProperties, {recurseIntoIframes: true});
                console.log(makeThemeCSSFile(cssProperties));
            }
        }

        $("html").on("dragover", (event) => {
            event.preventDefault();
            event.stopPropagation();
        });
        $("html").on("dragleave", (event) => {
            event.preventDefault();
            event.stopPropagation();
        });
        $("html").on("drop", (event) => {
            event.preventDefault();
            event.stopPropagation();
            const files = [...event.originalEvent.dataTransfer.files];
            for (const file of files) {
                if (file.name.match(/\.theme(pack)?$/i)) {
                    loadThemeFile(file);
                }
            }
        });

        // Generate variations of scrollbars
        const $scrollbar_buttons = $(".scrollbar-demo");
        $scrollbar_buttons.after(
            $scrollbar_buttons.clone().css("--scrollbar-size", "15px"),
            $scrollbar_buttons.clone().css("--scrollbar-size", "16px"),
            $scrollbar_buttons.clone().css("--scrollbar-size", "30px"),
        );
        $(".scrollbar-demo").each((index, element) => {
            applyCSSProperties(renderThemeGraphics(getComputedStyle(element)), {element});
        });
    });

</script>
</body>
</html>